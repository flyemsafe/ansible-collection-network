---
# Firewall Management Module Entry Point
#
# This module manages pfSense firewall configuration including aliases and rules.
# Uses pfSense REST API v2 for reliable, idempotent configuration management.

- name: Display firewall management plan
  ansible.builtin.debug:
    msg:
      - "Configuring pfSense firewall"
      - "Managing {{ pfsense_firewall_aliases | length }} alias(es)"
      - "Managing {{ pfsense_firewall_rules | length }} rule(s)"
  when: ansible_verbosity >= 1

# Alias Management
- name: Configure firewall aliases
  ansible.builtin.include_tasks: aliases_api.yml
  loop: "{{ pfsense_firewall_aliases }}"
  loop_control:
    loop_var: alias
  when:
    - pfsense_firewall_aliases | length > 0
    - alias.state | default('present') == 'present'

# Rule Management
- name: Configure firewall rules
  ansible.builtin.include_tasks: rules_api.yml
  loop: "{{ pfsense_firewall_rules }}"
  loop_control:
    loop_var: rule
  when:
    - pfsense_firewall_rules | length > 0
    - rule.state | default('present') == 'present'
