---
##################################################
# netboot.xyz Role - Firewall Configuration Tasks
##################################################
# Configures firewalld to allow PXE boot traffic
##################################################

- name: Configure firewall for netboot.xyz
  ansible.posix.firewalld:
    port: "{{ item }}"
    zone: "{{ netbootxyz_firewall_zone }}"
    permanent: true
    state: enabled
    immediate: true
  loop: "{{ netbootxyz_firewall_ports }}"
  register: firewall_config

- name: Display firewall configuration status
  ansible.builtin.debug:
    msg: |
      ==========================================
      üî• Firewall Configuration Complete
      ==========================================

      Zone: {{ netbootxyz_firewall_zone }}

      Ports Configured:
      {% for port in netbootxyz_firewall_ports %}
        - {{ port }}
      {% endfor %}

      {% set fw_changed = firewall_config.results | selectattr('changed') | list | length %}
      {% if fw_changed > 0 %}
      ‚úÖ Configured {{ fw_changed }} new firewall rule(s)
      {% else %}
      ‚ÑπÔ∏è  All firewall rules already configured
      {% endif %}

      ==========================================
