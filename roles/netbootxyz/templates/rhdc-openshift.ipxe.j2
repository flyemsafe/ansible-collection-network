#!ipxe

##################################################
# Rodhouse Datacenter - OpenShift Boot Menu
# Created by Ansible - rhdc.network.netbootxyz role
##################################################

:rhdc_openshift_menu
menu OpenShift Deployments
item --gap Boot Options:
item coreos_stable   Fedora CoreOS Stable (OpenShift Base) - {{ netbootxyz_coreos_stable_version }}
item coreos_testing  Fedora CoreOS Testing - {{ netbootxyz_coreos_testing_version }}
item coreos_next     Fedora CoreOS Next - {{ netbootxyz_coreos_next_version }}
item --gap Custom Deployments:
item openshift_sno   OpenShift Single Node (SNO)
item openshift_ipi   OpenShift IPI Installer
item --gap Utilities:
item coreos_ignition Configure CoreOS Ignition URL
item --gap
item return          Return to main menu
choose target && goto ${target}

:coreos_stable
# Chain to existing CoreOS menu with stable version
chain coreos.ipxe

:coreos_testing
# Chain to existing CoreOS menu with testing version
chain coreos.ipxe

:coreos_next
# Chain to existing CoreOS menu with next version
chain coreos.ipxe

:openshift_sno
# Custom OpenShift SNO boot entry
# This assumes you have uploaded the ISO to /assets/
set iso_url http://{{ ansible_fqdn }}:{{ netbootxyz_http_port }}/assets/openshift-sno-agent.iso
echo Loading OpenShift Single Node installer...
echo ISO: ${iso_url}
sanboot --no-describe --drive 0x80 ${iso_url} || goto openshift_sno_error

:openshift_sno_error
echo Error loading OpenShift SNO installer!
echo Please verify the ISO exists at: ${iso_url}
prompt Press any key to return to menu...
goto rhdc_openshift_menu

:openshift_ipi
echo OpenShift IPI installer not yet configured
echo
echo To configure IPI deployment:
echo 1. Download OpenShift installer from console.redhat.com
echo 2. Extract and run openshift-install create install-config
echo 3. Upload generated ISO to /assets/
echo 4. Update this menu with the ISO path
prompt Press any key to return to menu...
goto rhdc_openshift_menu

:coreos_ignition
# Interactive ignition URL configuration
echo ==========================================
echo CoreOS Ignition Configuration
echo ==========================================
echo Enter CoreOS Ignition Configuration URL:
{% if netbootxyz_default_ignition_url %}
echo (Press Enter to use default: {{ netbootxyz_default_ignition_url }})
{% endif %}
read ignition_url
{% if netbootxyz_default_ignition_url %}
isset ${ignition_url} || set ignition_url {{ netbootxyz_default_ignition_url }}
{% endif %}
set coreos.ignition.url ${ignition_url}
echo Ignition URL set to: ${ignition_url}
echo Chaining to CoreOS boot...
chain coreos.ipxe

:return
chain menu.ipxe
