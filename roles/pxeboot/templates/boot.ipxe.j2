#!ipxe

###############################################################################
# {{ pxeboot_menu_title }}
# Managed by Ansible - Modifications will be overwritten
#
# All boot options include SSH (inst.sshd) and VNC (inst.vnc) by default
# Connect via: ssh root@<ip> or VNC viewer to <ip>:5901
###############################################################################

:start
menu {{ pxeboot_menu_title }}
{% for rhel in pxeboot_rhel_versions %}
item --gap --             ──────────────────────────────────
item --gap --             RHEL {{ rhel.version }}:
{% for mode in pxeboot_boot_modes %}
item rhel{{ rhel.version | replace('.', '') }}-{{ mode.name }}         RHEL {{ rhel.version }} ({{ mode.label }})
{% endfor %}
{% endfor %}
{% if pxeboot_custom_entries | length > 0 %}
item --gap --             ──────────────────────────────────
item --gap --             Host-Specific:
{% for entry in pxeboot_custom_entries %}
item {{ entry.name }}         {{ entry.label }}
{% endfor %}
{% endif %}
item --gap --             ──────────────────────────────────
item --gap --             Utilities:
item shell                iPXE Shell
item localboot            Boot from Local Disk
choose --default {{ pxeboot_default_option }} --timeout {{ pxeboot_menu_timeout }} target && goto ${target}

{% for rhel in pxeboot_rhel_versions %}
{% for mode in pxeboot_boot_modes %}
:rhel{{ rhel.version | replace('.', '') }}-{{ mode.name }}
chain rhel-{{ rhel.version | replace('.', '') }}-{{ mode.name }}.ipxe || goto error

{% endfor %}
{% endfor %}
{% for entry in pxeboot_custom_entries %}
:{{ entry.name }}
chain {{ entry.name }}.ipxe || goto error

{% endfor %}
:shell
shell
goto start

:localboot
echo Booting from local disk...
exit 1

:error
echo
echo ============================================
echo Error: Failed to load boot configuration
echo ============================================
echo
echo Press any key to return to menu...
prompt
goto start
